kind: ConfigMap
apiVersion: v1
metadata:
  name: elastiflow-nginx-config
  labels:
    app: elastiflow-nginx
    chart: "{{ .Chart.Name }}"
    heritage: {{ .Release.Service | quote }}
    release: {{ .Release.Name | quote }}
data:
  nginx.conf: |
    user nginx;
    worker_processes  3;
    error_log  /dev/stdout info;
    events {
      worker_connections  10240;
    }

    stream {
      include /etc/nginx/virtualhost/virtualhost.conf;
    }
  virtualhost.conf: |
    upstream logstash_udp_upstream {
        server elastiflow-logstash-1.elastiflow-logstash-svc:2055;
        server elastiflow-logstash-0.elastiflow-logstash-svc:2055;
    }
    server {
        listen 2055 udp;
        proxy_pass logstash_udp_upstream;
        proxy_responses 0;
        proxy_buffer_size 4096k;
        proxy_bind $remote_addr:$remote_port transparent;
    }